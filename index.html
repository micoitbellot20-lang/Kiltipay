// 1. FONCTION DE DON RAPIDE (TIP)
async function sendTip() {
    const amount = 50; // Montant fixe pour le test
    const userRef = db.collection("users").doc(auth.currentUser.uid);
    
    try {
        await db.runTransaction(async (transaction) => {
            const doc = await transaction.get(userRef);
            if (!doc.exists) return;
            
            const newBalance = doc.data().balance - amount;
            if (newBalance < 0) throw "Solde insuffisant";
            
            transaction.update(userRef, { balance: newBalance });
            
            // Enregistre la transaction
            const txRef = db.collection("transactions").doc();
            transaction.set(txRef, {
                fromUid: auth.currentUser.uid,
                to: "CrÃ©ateur Kilti",
                amount: amount,
                date: new Date()
            });
        });
        showNotification("â¤ï¸ Don de 50 HTG envoyÃ© !");
    } catch (e) {
        showNotification("âŒ Erreur: " + e);
    }
}

// 2. EFFET DOUBLE TAP (LIKE)
let lastTap = 0;
document.addEventListener('touchend', function (e) {
    const currentTime = new Date().getTime();
    const tapLength = currentTime - lastTap;
    if (tapLength < 300 && tapLength > 0) {
        handleLike(e);
    }
    lastTap = currentTime;
});

function handleLike(e) {
    showNotification("ðŸ’– Vous avez aimÃ© cette vidÃ©o");
    // Ici on pourrait ajouter une animation de cÅ“ur qui monte
}

// 3. SYSTÃˆME DE NOTIFICATION
function showNotification(msg) {
    const notif = document.createElement('div');
    notif.style = "position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:10px 20px; border-radius:20px; z-index:2000; font-size:14px; border:1px solid var(--tiktok-blue);";
    notif.innerText = msg;
    document.body.appendChild(notif);
    setTimeout(() => notif.remove(), 2500);
}
