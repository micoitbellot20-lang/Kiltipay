<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiltiPay Pro - Tout-en-un</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root { --blue: #1a4da1; --green: #5cb85c; --red: #d9534f; --gray: #f4f4f4; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--blue); color: white; margin: 0; padding: 0; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 500px; background: white; color: #333; min-height: 100vh; position: relative; padding-bottom: 70px; }
        
        /* AUTH SECTION */
        #authSection { padding: 40px 20px; text-align: center; }
        .logo { font-size: 35px; font-weight: bold; color: var(--blue); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-success { background: var(--green); color: white; }

        /* DASHBOARD SECTION */
        #dashboard { display: none; }
        header { background: var(--blue); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
        
        /* WALLET CARD */
        .wallet-card { background: linear-gradient(135deg, #1a4da1, #3a7bd5); color: white; padding: 20px; margin: 15px; border-radius: 15px; text-align: left; }
        .wallet-balance { font-size: 24px; font-weight: bold; }

        /* CONTENT FEED */
        #feed { padding: 15px; }
        .post-card { background: var(--gray); border-radius: 15px; padding: 15px; margin-bottom: 20px; border-bottom: 3px solid #ddd; }
        .post-header { display: flex; align-items: center; margin-bottom: 10px; font-size: 12px; font-weight: bold; color: var(--blue); }
        .video-placeholder { width: 100%; height: 200px; background: #000; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; margin: 10px 0; }

        /* NAV BAR */
        .nav-bar { position: fixed; bottom: 0; width: 100%; max-width: 500px; background: white; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 10px 0; }
        .nav-item { font-size: 12px; cursor: pointer; text-align: center; color: #666; }
        .nav-item.active { color: var(--blue); font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="authSection">
        <div class="logo">KiltiPay</div>
        <p>Rejoignez la r√©volution culturelle</p>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Mot de passe">
        <button class="btn btn-success" onclick="handleAuth()">S'INSCRIRE / SE CONNECTER</button>
    </div>

    <div id="dashboard">
        <header>
            <span>KiltiPay</span>
            <button onclick="logout()" style="background:none; border:none; color:white; cursor:pointer;">Quitter</button>
        </header>

        <div class="wallet-card">
            <div style="font-size: 12px; opacity: 0.8;">Mon Solde KiltiPay</div>
            <div class="wallet-balance" id="userBalance">0.00 HTG</div>
            <button style="margin-top:10px; font-size:10px; border-radius:5px; border:none; padding:5px 10px;">Recharger avec MonCash</button>
        </div>

        <div id="feed">
            <div style="margin-bottom: 20px;">
                <strong>Publier un d√©bat :</strong>
                <textarea id="postInput" style="width:100%; margin-top:5px; border-radius:10px; border:1px solid #ddd; padding:10px;" placeholder="Quoi de neuf ?"></textarea>
                <button class="btn btn-success" style="padding:10px;" onclick="publishPost()">Publier</button>
            </div>
            <div id="livePosts"></div>
        </div>

        <div class="nav-bar">
            <div class="nav-item active">üè† Accueil</div>
            <div class="nav-item">üìΩÔ∏è Vid√©os</div>
            <div class="nav-item">üë§ Profil</div>
            <div class="nav-item">‚öôÔ∏è Param√®tres</div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCUy2bLdARmHnKseXFqk39NQSNy6oA8ibo",
        authDomain: "kashpay-app.firebaseapp.com",
        projectId: "kashpay-app",
        storageBucket: "kashpay-app.firebasestorage.app",
        messagingSenderId: "591201390460",
        appId: "1:591201390460:web:4a5317716dc6be02789ef9"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function handleAuth() {
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('password').value;
        auth.createUserWithEmailAndPassword(email, pass)
            .then((user) => { initializeUser(user.user.uid, email); })
            .catch(() => {
                auth.signInWithEmailAndPassword(email, pass)
                    .then(() => { showDashboard(email); })
                    .catch((err) => alert(err.message));
            });
    }

    function initializeUser(uid, email) {
        db.collection("users").doc(uid).set({
            email: email,
            balance: 50.00, // Cadeau de bienvenue (simulation)
            role: "fan"
        }).then(() => { showDashboard(email); });
    }

    function showDashboard(email) {
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // Charger le solde
        db.collection("users").doc(auth.currentUser.uid).onSnapshot(doc => {
            if(doc.exists) document.getElementById('userBalance').innerText = doc.data().balance.toFixed(2) + " HTG";
        });
        
        loadPosts();
    }

    function publishPost() {
        const text = document.getElementById('postInput').value;
        if(!text) return;
        db.collection("posts").add({
            text: text,
            author: auth.currentUser.email,
            date: firebase.firestore.FieldValue.serverTimestamp(),
            likes: 0
        }).then(() => { document.getElementById('postInput').value = ""; });
    }

    function loadPosts() {
        db.collection("posts").orderBy("date", "desc").onSnapshot(snapshot => {
            const list = document.getElementById('livePosts');
            list.innerHTML = "";
            snapshot.forEach(doc => {
                const p = doc.data();
                list.innerHTML += `
                    <div class="post-card">
                        <div class="post-header">üë§ ${p.author}</div>
                        <div style="font-size:15px;">${p.text}</div>
                        <div style="margin-top:10px; display:flex; gap:15px; font-size:12px; color:#666;">
                            <span>‚ù§Ô∏è Like</span>
                            <span onclick="alert('Bient√¥t disponible : Soutenir avec 10 HTG')">üí∞ Soutenir</span>
                        </div>
                    </div>
                `;
            });
        });
    }

    function logout() { auth.signOut().then(() => { location.reload(); }); }
</script>
</body>
</html>
